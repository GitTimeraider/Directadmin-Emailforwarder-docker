{% extends "base.html" %}

{% block content %}
<div class="container dashboard-container">

    <div id="messageContainer"></div>

    {% if not current_user.has_da_config() %}
        <div class="alert alert-warning">
            <p>DirectAdmin is not configured. Please <a href="{{ url_for('settings.index') }}">configure your settings</a> first.</p>
        </div>
    {% else %}
        <!-- Domain Selector -->
        <div class="card">
            <div class="domain-selector">
                <label for="domainSelect">Select Domain</label>
                <select id="domainSelect" onchange="switchDomain()">
                    <option value="">Loading domains...</option>
                </select>
            </div>
        </div>

        <!-- Create Forwarder Form -->
        <div class="card">
            <h3>Create New Forwarder</h3>
            <form id="createForwarderForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="address">Email Address</label>
                        <div class="input-group">
                            <input type="text" id="alias" name="alias" required pattern="[-a-zA-Z0-9._]+" title="Alphanumeric characters, dots, underscores, and hyphens only" class="input-bar">
                            <button type="button" class="btn-dice" onclick="generateRandomAlias()" title="Generate random email address">ðŸŽ²</button>
                            <span class="input-addon" id="domainSuffix">@loading...</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="destination">Forward To</label>
                        <select id="destination" name="destination" required class="input-bar">
                            <option value="">Loading email accounts...</option>
                        </select>
               <input type="text" id="custom-destination" name="custom-destination" 
                   placeholder="Enter email address or special destination (e.g., :blackhole:)" 
                   class="input-bar">
                    </div>

                    <div class="form-group form-actions">
                        <button type="submit" class="btn-primary">Create Forwarder</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Existing Forwarders -->
        <div class="card">
            <h3>Existing Forwarders</h3>
            <div class="table-container">
                <table id="forwardersTable">
                    <thead>
                        <tr>
                            <th>From</th>
                            <th>To</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" class="loading">Loading forwarders...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}
</div>

 
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
{% endblock %}
